Installing NS3 and testing simulations.
-----

http://www.nsnam.org/

NS3 releases are available as tar.gz archives.

** Download ns-3.15 specifically
(3.21 ran into problems - see log)

Extract bz2 and rename to $HOME/.../repos/ns3
(so that there is "repos/ns3/build.py" instead of "repos/ns3/ns3-allinone-.../build.py")


sudo apt-get install
   qt4-qmake  (required by build.py)
   libqt4-dev (required by build.py)

(repos/ns3)
(3.15) ./build.py -­‐disable-nsc --disable-netanim
[19/01/15] (3.21) ./build.py --disable-netanim
This step is a 'fast build' to get some non-Click/Blackadder dependencies compiled first 
 
 I got a message "NS-3 Click Integration : not enabled (nsclick not enabled (see option --with-nsclick))"
"
Modules built:
antenna                   aodv                      applications             
bridge                    buildings                 config-store             
core                      csma                      csma-layout              
dsdv                      dsr                       emu                      
energy                    fd-net-device             flow-monitor             
internet                  lr-wpan                   lte                      
mesh                      mobility                  mpi                      
netanim (no Python)       network                   nix-vector-routing       
olsr                      point-to-point            point-to-point-layout    
propagation               sixlowpan                 spectrum                 
stats                     tap-bridge                test (no Python)         
topology-read             uan                       virtual-net-device       
wave                      wifi                      wimax                    

Modules not built (see ns-3 tutorial for explanation):
brite                     click                     openflow                 
visualizer"

 
 
 Doing the other steps:
 
                                                                           v Insert version number.
 ln -s $HOME/.../repos/blackadder/ns3/blackadder-model $HOME/.../repos/ns3/ns-3.XX/src/blackadder
 ln -s $HOME/.../repos/blackadder/ns3/blackadder-examples $HOME/.../repos/ns3-ns-3.XX/examples/blackadder
 
 cd ns-3.XX/
 ./waf configure ***
 --with-nsclick=$HOME/.../repos/click
 
[19/01/15] ./waf configure --enable-examples --enable-tests --with-nsclick=$HOME/Desktop/Project/repos/click

ERRORS:
  File "/home/jack/Desktop/Project/repos/ns-allinone-3.21/ns-3.21/.waf-1.7.13-5a064c2686fe54de4e11018d22148cfc/waflib/Scripting.py", line 97, in waf_entry_point
    run_commands()
  File "/home/jack/Desktop/Project/repos/ns-allinone-3.21/ns-3.21/.waf-1.7.13-5a064c2686fe54de4e11018d22148cfc/waflib/Scripting.py", line 153, in run_commands
    ctx=run_command(cmd_name)
  File "/home/jack/Desktop/Project/repos/ns-allinone-3.21/ns-3.21/.waf-1.7.13-5a064c2686fe54de4e11018d22148cfc/waflib/Scripting.py", line 146, in run_command
    ctx.execute()
  File "/home/jack/Desktop/Project/repos/ns-allinone-3.21/ns-3.21/.waf-1.7.13-5a064c2686fe54de4e11018d22148cfc/waflib/Configure.py", line 128, in execute
    super(ConfigurationContext,self).execute()
  File "/home/jack/Desktop/Project/repos/ns-allinone-3.21/ns-3.21/.waf-1.7.13-5a064c2686fe54de4e11018d22148cfc/waflib/Context.py", line 87, in execute
    self.recurse([os.path.dirname(g_module.root_path)])
  File "/home/jack/Desktop/Project/repos/ns-allinone-3.21/ns-3.21/.waf-1.7.13-5a064c2686fe54de4e11018d22148cfc/waflib/Context.py", line 128, in recurse
    user_function(self)
  File "/home/jack/Desktop/Project/repos/ns-allinone-3.21/ns-3.21/wscript", line 378, in configure
    conf.recurse('src')
  File "/home/jack/Desktop/Project/repos/ns-allinone-3.21/ns-3.21/.waf-1.7.13-5a064c2686fe54de4e11018d22148cfc/waflib/Context.py", line 128, in recurse
    user_function(self)
  File "/home/jack/Desktop/Project/repos/ns-allinone-3.21/ns-3.21/src/wscript", line 68, in configure
    conf.recurse(module, mandatory=False)
  File "/home/jack/Desktop/Project/repos/ns-allinone-3.21/ns-3.21/.waf-1.7.13-5a064c2686fe54de4e11018d22148cfc/waflib/Context.py", line 128, in recurse
    user_function(self)
  File "/home/jack/Desktop/Project/repos/ns-allinone-3.21/ns-3.21/src/blackadder/wscript", line 19, in configure
    if conf.options_test.disable_nsclick:
AttributeError: 'ConfigurationContext' object has no attribute 'options_test'
---


 
 "No module named Options" - Haven't seen a solution to this online.
Possibly caused by cut/pasting repos/ns3/.../ to repos/ns3/ via GUI/without checking for hidden files.

PYTHONPATH=$HOME/Desktop/Project/repos/ns3/ns-3.21/.waf*/waflib python waf configure





Log
---

I tried using ns-3.21 (latest as of 12/2014) instead of ns-3.15 ("tested with" in HowTo), but ran into some problems:

-­‐disable-nsc doesn't exist on ns-3.21
(No negative effects, but just noting a difference)

Errors during ./waf steps:
 
 "No module named Options" - Haven't seen a solution to this online.
repos/ns3/.waf-.../waflib (hidden, generated by "waf") contains an "Options.py"


PYTHONPATH=$HOME/Desktop/Project/repos/ns3/ns-3.21/.waf*/waflib python waf configure
Fails in the same way.

PYTHONPATH=$HOME/Desktop/Project/repos/ns3/ns-3.21/.waf3-1.7.13-5a064c2686fe54de4e11018d22148cfc/waflib python waf configure
Fails at "if Options.options.disable_nsclick", "no attribute named disable_nsclick"

PYTHONPATH=$HOME/Desktop/Project/repos/ns3/ns-3.21/.waf3-1.7.13-5a064c2686fe54de4e11018d22148cfc/waflib python waf configure --disable-nsclick
Fails at "if Options.options.disable_nsclick" in the same way.

NS3 WITH CLICK BUT NOT BLACKADDER:

Not doing symbolic link steps.
./waf configure --enable-examples --enable-tests --with-nsclick=$HOME/.../repos/click

Works fine.

"blackadder/wscript" can't find module "Options", and "waflib/Options.py" doesn't seem to be the same thing. (or wrong PYTHONPATH)

Trying 3.15 (HowTo.pdf says this works) instead.

"Build failed
 -> task in 'ns3-network' failed (exit status 1):"
 
http://ns-3-users.narkive.com/bzwpcBHL/error-of-building-ns-3-15-on-ubuntu-13-10
"A backward solution for 3.15 doesn't exist, as the amount of work would be
the same as forward-porting anything written for 3.15 (or older ns-3
version) to 3.19."

---

Trying to fix 3.21 instead.

“Never add a package directory, or any directory inside a package, directly to the Python path”

Modules built:
antenna                   aodv                      applications             
bridge                    buildings                 config-store             
core                      csma                      csma-layout              
dsdv                      dsr                       emu                      
energy                    fd-net-device             flow-monitor             
internet                  lr-wpan                   lte                      
mesh                      mobility                  mpi                      
netanim (no Python)       network                   nix-vector-routing       
olsr                      point-to-point            point-to-point-layout    
propagation               sixlowpan                 spectrum                 
stats                     tap-bridge                test (no Python)         
topology-read             uan                       virtual-net-device       
wave                      wifi                      wimax                    

Modules not built (see ns-3 tutorial for explanation):
brite                     click                     openflow                 
visualizer 

On running ./waf:
...
  File "/home/jack/Desktop/Project/repos/ns-allinone-3.21/ns-3.21/src/blackadder/wscript", line 4, in <module>
    import Options
ImportError: No module named Options

Found an Options.py in ns-3.21/waflib/
Copied to ns-3.21/src/blackadder

On running ./waf configure
...
"File "/home/jack/Desktop/Project/repos/ns-allinone-3.21/ns-3.21/src/blackadder/wscript", line 16, in configure
    if Options.options.disable_nsclick:
AttributeError: 'dict' object has no attribute 'disable_nsclick'"

Following path of references to see if this Options.py is the correct one:
"Options" is the top-level import
"options" is a {} created in Options.py
"options" is only modified by: (options,leftover_args)=self.parser.parse_args(args=_args)
"parser" is from "optparse" library

Expected behaviour is "options.disable_nsclick = False" as wscript has "default=False".


"Context.create_context('options').execute()" runs "def options(opt):" in wscript:
def options(opt):
    opt.add_option('--with-nsclick',
                   help=('Path to Click source or installation prefix for NS-3 Click Integration support'),
                   dest='with_nsclick', default=None)
    opt.add_option('--disable-nsclick',
                   help=('Disable NS-3 Click Integration support'),
                   dest='disable_nsclick', default=False, action="store_true")
                   
Context.py runs "user_function(self)" passing "self" not an "Options" instance, I think?

WITH HACKED MODIFIED Configure.py & wscript
Doesn't need copied Options.py

./waf configure --enable-examples --enable-tests --with-nsclick=$HOME/Desktop/Project/repos/click

-- Summary of optional NS-3 features:
Build profile                 : debug
Build directory               : /home/jack/Desktop/Project/repos/ns-allinone-3.21/ns-3.21/build
Python Bindings               : enabled
Python API Scanning Support   : not enabled (Missing 'pygccxml' Python module)
NS-3 Click Integration        : enabled
BRITE Integration             : not enabled (BRITE not enabled (see option --with-brite))
NS-3 Click Integration        : enabled
GtkConfigStore                : not enabled (library 'gtk+-2.0 >= 2.12' not found)
XmlIo                         : not enabled (library 'libxml-2.0 >= 2.7' not found)
Threading Primitives          : enabled
Real Time Simulator           : enabled
Emulated Net Device           : enabled
File descriptor NetDevice     : enabled
Tap FdNetDevice               : enabled
Emulation FdNetDevice         : enabled
PlanetLab FdNetDevice         : not enabled (PlanetLab operating system not detected (see option --force-planetlab))
Network Simulation Cradle     : not enabled (NSC not found (see option --with-nsc))
MPI Support                   : not enabled (option --enable-mpi not selected)
NS-3 OpenFlow Integration     : not enabled (Required boost libraries not found, missing: system, signals, filesystem)
SQlite stats data output      : not enabled (library 'sqlite3' not found)
Tap Bridge                    : enabled
PyViz visualizer              : not enabled (Missing python modules: goocanvas, pygraphviz)
Use sudo to set suid bit      : not enabled (option --enable-sudo not selected)
Build tests                   : enabled
Build examples                : enabled
GNU Scientific Library (GSL)  : not enabled (GSL not found)
'configure' finished successfully (7.465s)

It's enabled twice, which is a bit weird.


./waf build
"AttributeError: 'BuildContext' object has no attribute 'new_task_gen'"
https://groups.google.com/forum/#!topic/ns-3-users/JzUvWiWn9UY

"where you used to write: 

     headers = bld.new_task_gen(features=['ns3header']) 

you now must write: 

     headers = bld(features='ns3header') "
     
"AttributeError: 'BuildContext' object has no attribute 'add_subdirs'"
https://github.com/jvaubourg/plc/commit/50b98b95c3a5d5f648778b602fdec44b09e6dfaa
"Use recurse() instead of add_subdirs()."

Compile process starts, [xxx/2417]

"[1178/2417] cxx: src/blackadder/model/pub-sub-application.cc -> build/src/blackadder/model/pub-sub-application.cc.1.o
../src/blackadder/model/pub-sub-application.cc: In member function ‘void ns3::PubSubApplication::DoStart()’:
../src/blackadder/model/pub-sub-application.cc:39:9: error: ‘DoStart’ is not a member of ‘ns3::Application’
         Application::DoStart();
         ^
Waf: Leaving directory `/home/jack/Desktop/Project/repos/ns-allinone-3.21/ns-3.21/build'
Build failed
 -> task in 'ns3-blackadder' failed (exit status 1): 
	{task 140028428085840: cxx pub-sub-application.cc -> pub-sub-application.cc.1.o}
['/usr/bin/g++', '-O0', '-ggdb', '-g3', '-Wall', '-Werror', '-Wno-error=deprecated-declarations', '-fstrict-aliasing', '-Wstrict-aliasing', '-fPIC', '-pthread', '-I.', '-I..', '-I/home/jack/Desktop/Project/repos/click/include', '-DNS3_ASSERT_ENABLE', '-DNS3_LOG_ENABLE', '-DHAVE_SYS_IOCTL_H=1', '-DHAVE_IF_NETS_H=1', '-DHAVE_NET_ETHERNET_H=1', '-DHAVE_PACKET_H=1', '-DHAVE_IF_TUN_H=1', '-DNS3_CLICK', '../src/blackadder/model/pub-sub-application.cc', '-c', '-o', 'src/blackadder/model/pub-sub-application.cc.1.o']"

Ideally I'd like to not modify waf's core: Possibly changing working directories/PYTHONPATH/similar.
